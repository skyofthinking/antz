<!DOCTYPE html>
<html lang="ZH">
<head>
    <meta charset="UTF-8">
    <title>Spring Boot + MyBatis + Vue + ElementUI</title>
    <link rel="stylesheet" href="http://cdn.bootcss.com/element-ui/1.4.3/theme-default/index.css">
    <script src="http://cdn.bootcss.com/vue/2.4.2/vue.min.js"></script>
    <script src="http://cdn.bootcss.com/element-ui/1.4.3/index.js"></script>
    <script src="http://cdn.bootcss.com/vue-resource/1.3.4/vue-resource.min.js"></script>
</head>
<body>
<div id="vm">
    <el-row :gutter="3" style="margin: 10px 0;">
        <el-col :span="6">
            <el-input placeholder="输入用户名称查询" style="width: 200px;" v-model="name" icon="search" @change="queryName"></el-input>
            <el-button class="filter-item" style="margin-left: 10px;" @click="preCreate" type="primary" icon="edit">
                添加
            </el-button>
        </el-col>
    </el-row>

    <el-table border fit highlight-current-row :data="list" style="width: 100%;font-size: 12px;">
        <el-table-column type="index" width="50"></el-table-column>
        <el-table-column label="姓名">
            <template scope="scope">
                <span class="link-type" @click="preUpdate(scope.row)">{{scope.row.name}}</span>
            </template>
        </el-table-column>
        <el-table-column prop="sex" label="性别" :formatter="formatSex"></el-table-column>
        <el-table-column prop="createDate.time" label="创建时间" sortable :formatter="formatCreateDate"></el-table-column>
    </el-table>

    <el-col class="toolbar" style="padding:10px;">
        <el-pagination @current-change="query" :current-page="currentPage" :page-size="10" layout="total, prev, pager, next, jumper" :total="total" style="float:right"></el-pagination>
    </el-col>

    <el-dialog :title="textMap[dialogStatus]" :visible.sync="dialogFormVisible">
        <el-form class="small-space" :model="entity" label-position="left" label-width="70px" style='width: 400px; margin-left:50px;'>
            <el-form-item label="姓名">
                <el-input v-model="entity.name"></el-input>
            </el-form-item>

            <el-form-item label="性别">
                <el-select class="filter-item" v-model="entity.sex" placeholder="请选择">
                    <el-option v-for="item in sexOptions" :key="item.key" :label="item.label" :value="item.key">
                    </el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button v-if="dialogStatus=='create'" type="primary" @click="create">确 定</el-button>
            <el-button v-else type="primary" @click="update">确 定</el-button>
        </div>
    </el-dialog>
</div>
</body>
<script>
    const sexOptions = [
        {key: '1', label: '男'},
        {key: '2', label: '女'}
    ];

    Vue.http.options.emulateJSON = true;
    Vue.http.options.emulateHTTP = true;
    var vm = new Vue({
        el: '#vm',
        data: {
            list: [],
            total: 10,
            currentPage: 1,
            listLoading: false,
            dialogFormVisible: false,
            dialogStatus: '',
            textMap: {
                update: '编辑',
                create: '创建'
            },
            entity: {
                name: '',
                sex: ''
            },
            name: ''
        },
        mounted: function () {
            this.query();
        },
        methods: {
            query: function (currentPage) {
                this.listLoading = true;
                if (!isNaN(currentPage)) {
                    this.currentPage = currentPage;
                }
                var params_ = {pageNo: this.currentPage, pageSize: 10};
                if (this.name && this.name.trim() != "") {
                    params_['name'] = this.name;
                }
                this.$http.get("http://localhost:9090/user/query", {params: params_}).then(function (response) {
                    console.log(response.data);
                    this.total = response.data.count;
                    this.list = [];
                    for (var key in response.data.data) {
                        this.$set(this.list, key, response.data.list[key]);
                    }
                }).catch(function (response) {
                    console.error(response);
                });
                this.listLoading = false;
            },
            preCreate: function () {
                this.dialogStatus = 'create';
                this.dialogFormVisible = true;
            },
            create: function () {
                this.dialogFormVisible = false;
            },
            preUpdate: function (row) {
                this.entity = Object.assign({}, row);
                this.dialogStatus = 'update';
                this.dialogFormVisible = true;
            },
            update: function () {
                this.dialogFormVisible = false;
            },
            formatDate: function getNowFormatDate(time) {
                var date = new Date(time);
                var seperator1 = "-";
                var seperator2 = ":";
                var month = date.getMonth() + 1;
                var strDate = date.getDate();
                if (month >= 1 && month <= 9) {
                    month = "0" + month;
                }
                if (strDate >= 0 && strDate <= 9) {
                    strDate = "0" + strDate;
                }
                var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate + " " + date.getHours() + seperator2 + date.getMinutes() + seperator2 + date.getSeconds();
                return currentdate;

            },
            formatCreateDate: function (row, column) {
                if (row.createDate != null) {
                    return this.formatDate(row.createDate);
                } else {
                    return '';
                }
            },
            formatSex: function (row, column) {
                if (row.sex != null) {
                    return row.sex == 1 ? '男' : '女';
                }
            },
            queryName: function () {
                this.query(1);
            }
        }
    });
</script>
</html>